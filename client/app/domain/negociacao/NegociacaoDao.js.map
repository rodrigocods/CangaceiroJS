{"version":3,"sources":["../../../app-src/domain/negociacao/NegociacaoDao.js"],"names":["Negociacao","NegociacaoDao","constructor","connection","_connection","_store","adiciona","negociacao","Promise","resolve","reject","request","transaction","objectStore","add","onsuccess","response","onerror","apagaTodos","clear","listaTodos","negociacoes","cursor","openCursor","atual","target","result","value","_data","_quantidade","_valor","push","continue","console","log","error"],"mappings":";;;;;;AAASA,sB,iBAAAA,U;;;AAEF,kBAAMC,aAAN,CACP;AACIC,4BAAYC,UAAZ,EACA;AACI,yBAAKC,WAAL,GAAmBD,UAAnB;;AAEA,yBAAKE,MAAL,GAAc,aAAd;AACH;;AAEDC,yBAASC,UAAT,EACA;AACI,2BAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KACnB;AACI,8BAAMC,UAAU,KAAKP,WAAL,CACXQ,WADW,CACC,CAAC,KAAKP,MAAN,CADD,EACgB,WADhB,EAEXQ,WAFW,CAEC,KAAKR,MAFN,EAGXS,GAHW,CAGPP,UAHO,CAAhB;;AAKAI,gCAAQI,SAAR,GAAoBC,YAAYP,SAAhC;;AAEAE,gCAAQM,OAAR,GAAkBD,YAClB;AACIN,mCAAO,sCAAP;AACH,yBAHD;AAIH,qBAbM,CAAP;AAcH;;AAEDQ,6BACA;AACI,2BAAO,IAAIV,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KACnB;AACI,8BAAMC,UAAU,KAAKP,WAAL,CACXQ,WADW,CACC,CAAC,KAAKP,MAAN,CADD,EACgB,WADhB,EAEXQ,WAFW,CAEC,KAAKR,MAFN,EAGXc,KAHW,EAAhB;;AAKAR,gCAAQI,SAAR,GAAoBC,YAAYP,SAAhC;;AAEAE,gCAAQM,OAAR,GAAkBD,YAClB;AACIN,mCAAO,sCAAP;AACH,yBAHD;AAIH,qBAbM,CAAP;AAcH;;AAEDU,6BACA;AACI,2BAAO,IAAIZ,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KACnB;AACI,8BAAMW,cAAc,EAApB;;AAEA,8BAAMC,SAAS,KAAKlB,WAAL,CAAiBQ,WAAjB,CAA6B,CAAC,KAAKP,MAAN,CAA7B,EAA4C,WAA5C,EAAyDQ,WAAzD,CAAqE,KAAKR,MAA1E,EAAkFkB,UAAlF,EAAf;;AAEAD,+BAAOP,SAAP,GAAmBC,YAAY;;AAE3B,kCAAMQ,QAAQR,SAASS,MAAT,CAAgBC,MAA9B;;AAEA,gCAAIF,KAAJ,EAAW;;AAEP,sCAAMjB,aAAa,IAAIP,UAAJ,CAAewB,MAAMG,KAAN,CAAYC,KAA3B,EAAkCJ,MAAMG,KAAN,CAAYE,WAA9C,EAA2DL,MAAMG,KAAN,CAAYG,MAAvE,CAAnB;;AAEAT,4CAAYU,IAAZ,CAAiBxB,UAAjB;AACAiB,sCAAMQ,QAAN;AACH,6BAND,MAMO;;AAEHvB,wCAAQY,WAAR;AACH;AACJ,yBAdD;;AAgBAC,+BAAOL,OAAP,GAAiBD,YAAY;AACzBiB,oCAAQC,GAAR,CAAYlB,SAASS,MAAT,CAAgBU,KAA5B;AACAzB,mCAAO,yCAAP;AACH,yBAHD;AAIH,qBA1BM,CAAP;AA2BH;AAzEL","file":"NegociacaoDao.js","sourcesContent":["import { Negociacao } from \"./Negociacao.js\";\r\n\r\nexport class NegociacaoDao\r\n{\r\n    constructor(connection)\r\n    {\r\n        this._connection = connection;\r\n\r\n        this._store = \"negociacoes\";\r\n    }\r\n\r\n    adiciona(negociacao)\r\n    {\r\n        return new Promise((resolve, reject) =>\r\n        {\r\n            const request = this._connection\r\n                .transaction([this._store], 'readwrite')\r\n                .objectStore(this._store)\r\n                .add(negociacao);\r\n\r\n            request.onsuccess = response => resolve();\r\n\r\n            request.onerror = response => \r\n            {\r\n                reject('Não foi possível salvar a negociação');\r\n            }\r\n        });\r\n    }\r\n\r\n    apagaTodos()\r\n    {\r\n        return new Promise((resolve, reject) =>\r\n        {\r\n            const request = this._connection\r\n                .transaction([this._store], 'readwrite')\r\n                .objectStore(this._store)\r\n                .clear();\r\n\r\n            request.onsuccess = response => resolve();\r\n\r\n            request.onerror = response => \r\n            {\r\n                reject('Não foi possível salvar a negociação');\r\n            }\r\n        });\r\n    }\r\n\r\n    listaTodos()\r\n    {\r\n        return new Promise((resolve, reject) => \r\n        {\r\n            const negociacoes = [];\r\n\r\n            const cursor = this._connection.transaction([this._store], 'readwrite').objectStore(this._store).openCursor();\r\n\r\n            cursor.onsuccess = response => {\r\n\r\n                const atual = response.target.result;\r\n\r\n                if (atual) {\r\n\r\n                    const negociacao = new Negociacao(atual.value._data, atual.value._quantidade, atual.value._valor);\r\n\r\n                    negociacoes.push(negociacao);\r\n                    atual.continue();\r\n                } else {\r\n\r\n                    resolve(negociacoes);\r\n                }\r\n            };\r\n\r\n            cursor.onerror = response => {\r\n                console.log(response.target.error);\r\n                reject('Não foi possível listar nas negociações');\r\n            };\r\n        });\r\n    }\r\n}"]}